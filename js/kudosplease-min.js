KudosPlease=(function(){function a(b){this.elements=document.querySelectorAll(b.el);this.status=b.status;this.persistent=b.persistent!=undefined?(b.persistent&&window.localStorage!=undefined):true;this.duration=b.duration;this.timer={};for(var c=0;c<this.elements.length;c++){var d=this.elements[c];d.setAttribute("data-id",c);this.request(d,"GET",this);if(this.loadAmount(c,this)==0){d.setAttribute("data-amount",0);this.timer[c]=-1;if(this.isTouch()){this.on(d,"touchstart",this.enter);this.on(d,"touchend",this.out)}else{this.on(d,"mouseover",this.enter);this.on(d,"mouseout",this.out)}}else{this.finish(d,false,this)}}return this}a.prototype.enter=function(c,b,f){var d=-1;if(!f.hasClass(b,"finish")){f.addClass(b,"active");d=setTimeout(function(){f.removeClass(b,"active");f.finish(b,true,f)},f.duration);f.timer[b.getAttribute("data-id")]=d}};a.prototype.out=function(c,b,d){if(!d.hasClass(b,"finish")){d.removeClass(b,"active");clearTimeout(d.timer[b.getAttribute("data-id")])}};a.prototype.finish=function(b,d,c){c.addClass(b,"finish");c.changeStatus(b,"gamma",c);d=d||false;amount=c.loadAmount(parseInt(b.getAttribute("data-id"),10),c);if(d){++amount;c.request(b,"POST",c)}};a.prototype.changeStatus=function(b,c,d){if(d.status!=undefined){if(b.getAttribute("data-status")!=undefined){d.removeClass(b,d.status[b.getAttribute("data-status")])}d.addClass(b,d.status[c]);b.setAttribute("data-status",c)}};a.prototype.on=function(c,f,d){var b=this;try{c.addEventListener(f,function(h){d(h,c,b)},false)}catch(g){c.attachEvent("on"+f,function(h){d(h,c,b)})}};a.prototype.addClass=function(d,c){c=c.split(",");for(var b=0;b<c.length;b++){if(d.className.indexOf(c[b])==-1){d.className=d.className.trim()+" "+c[b]}}};a.prototype.removeClass=function(d,c){c=c.split(",");for(var b=0;b<c.length;b++){d.className=d.className.replace(c[b],"").trim()}};a.prototype.hasClass=function(f,e){var d=f.className.split(" "),b=false;for(var c=0;c<d.length;c++){if(d[c]==e){b=true}}return b};a.prototype.isTouch=function(){return !!("ontouchstart" in window)||!!("onmsgesturechange" in window)};a.prototype.save=function(c,b,d){if(d.persistent){window.localStorage.setItem("kudos:saved:"+c.getAttribute("data-url"),b)}};a.prototype.loadAmount=function(d,c){var b=c.elements[d].getAttribute("data-amount")||0;if(c.persistent){if((amount=window.localStorage.getItem("kudos:saved:"+c.elements[d].getAttribute("data-url")))!=undefined){b=amount}}return b};a.prototype.request=function(d,c,i){var h,g=i;try{h=new ActiveXObject("Microsoft.XMLHTTP")}catch(f){h=new XMLHttpRequest()}h.onreadystatechange=function(){if(h.readyState==4&&h.status==200){var e=h.responseText;d.setAttribute("data-amount",e);if(c=="GET"){g.changeStatus(d,e==0?"alpha":"beta",g);if(g.persistent&&window.localStorage.getItem("kudos:saved:"+d.getAttribute("data-url"))!=null){g.changeStatus(d,"gamma",g)}}if(c=="POST"){g.save(d,e,g)}}};var b="?url="+encodeURIComponent(d.getAttribute("data-url"));h.open(c,"http://api.kudosplease.com/"+b,true);h.send()};"".trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});return a})();