KudosPlease=(function(){var b;function a(c){b=this;this.elements=document.querySelectorAll(c.el);this.status=c.status;this.persistent=(c.persistent!=undefined&&c.persistent&&localStorage!=undefined);this.duration=c.duration;this.timer={};this.currentStatus="";for(var d=0;d<this.elements.length;d++){var e=this.elements[d];e.setAttribute("data-id",d);b.request(e,"GET");if(this.loadAmount(d)==0){e.setAttribute("data-amount",0);this.timer[d]=-1;if(this.isTouch()){this.on(e,"touchstart",this.enter);this.on(e,"touchend",this.out)}else{this.on(e,"mouseover",this.enter);this.on(e,"mouseout",this.out)}}else{this.finish(e)}}}a.prototype.enter=function(d){var c=this,f=-1;if(!b.hasClass(this,"finish")){b.addClass(c,"active");f=setTimeout(function(){b.removeClass(c,"active");b.finish(c,true)},b.duration);b.timer[c.getAttribute("data-id")]=f}};a.prototype.out=function(c){if(!b.hasClass(this,"finish")){b.removeClass(this,"active");clearTimeout(b.timer[this.getAttribute("data-id")])}};a.prototype.finish=function(c,d){b.addClass(c,"finish");b.changeStatus(c,"gamma");d=d||false;amount=b.loadAmount(parseInt(c.getAttribute("data-id"),10));if(d){++amount;b.request(c,"POST")}};a.prototype.changeStatus=function(c,d){if(b.status!=undefined){b.removeClass(c,b.currentStatus);b.addClass(c,b.status[d]);b.currentStatus=b.status[d]}};a.prototype.on=function(c,f,d){try{c.addEventListener(f,d,false)}catch(g){c.attachEvent("on"+f,d)}};a.prototype.addClass=function(e,d){d=d.split(",");for(var c=0;c<d.length;c++){if(e.className.indexOf(d[c])==-1){e.className=e.className.trim()+" "+d[c]}}};a.prototype.removeClass=function(e,d){d=d.split(",");for(var c=0;c<d.length;c++){e.className=e.className.replace(d[c],"").trim()}};a.prototype.hasClass=function(g,f){var e=g.className.split(" "),c=false;for(var d=0;d<e.length;d++){if(e[d]==f){c=true}}return c};a.prototype.isTouch=function(){return !!("ontouchstart" in window)||!!("onmsgesturechange" in window)};a.prototype.save=function(d,c){if(b.persistent){localStorage.setItem("kudos:saved:"+d.getAttribute("data-url"),c)}};a.prototype.loadAmount=function(d){var c=b.elements[d].getAttribute("data-amount")||0;if(b.persistent){if((amount=localStorage.getItem("kudos:saved:"+b.elements[d].getAttribute("data-url")))!=null){c=amount}}return c};a.prototype.request=function(f,d){var h;try{h=new ActiveXObject("Microsoft.XMLHTTP")}catch(g){h=new XMLHttpRequest()}h.onreadystatechange=function(){if(h.readyState==4&&h.status==200){var e=h.responseText;f.setAttribute("data-amount",e);if(d=="GET"){b.changeStatus(f,e==0?"alpha":"beta")}if(d=="POST"){b.save(f,e)}}};var c="?url="+encodeURIComponent(f.getAttribute("data-url"));h.open(d,"http://api.kudosplease.com/"+c,true);h.send()};"".trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});return a})();